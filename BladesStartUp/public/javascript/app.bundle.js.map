{"version":3,"sources":["webpack:///public/javascript/app.bundle.js","webpack:///webpack/bootstrap f4a2fd9c67eba7027774?f354","webpack:///./../Blades.WebClient/BladesWeb/tools/json.ts?8c23","webpack:///./../Blades.WebClient/BladesWeb/webApi/serverConnection.ts?d0e9","webpack:///./frontend/main.ts"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","0","reISO","reMsAjax","parseMsAjaxDate","dateParser","key","a","exec","Date","b","split","json","parse","str","JSON","e","Error","stringify","data","1","json_1","noop","ServerConnection","this","connectionProtocol","connectionRoute","reconnectTimeout","reconnectIntervalRef","sendMessagesTimeout","sendMessagesIntervalRef","messagesQueue","rawMessageHandlers","notifyMessageHandlers","open","_this","connect","clearInterval","setInterval","ws","readyState","WebSocket","OPEN","close","document","location","host","bindEvents","sendMessagesFromQueue","onclose","onmessage","ev","rawMessage","processNotifyMessage","length","shift","send","push","forEach","handler","onRawMessage","index","indexOf","splice","message_1","messageRole","attributes","onNotifyMessage","connection","16","serverConnection_1"],"mappings":"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","file":"./public/javascript/app.bundle.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 16);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 0:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\n//date parse method from https://weblog.west-wind.com/posts/2014/jan/06/javascript-json-date-parsing-and-real-dates\r\nvar reISO = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*))(?:Z|(\\+|-)([\\d|:]*))?$/;\r\nvar reMsAjax = /^\\/Date\\((d|-|.*)\\)[\\/|\\\\]$/;\r\nvar parseMsAjaxDate = false;\r\nvar dateParser = function (key, value) {\r\n    /// <summary>\r\n    /// Globally enables JSON date parsing for JSON.parse().\r\n    /// Replaces the default JSON.parse() method and adds\r\n    /// the datePaser() extension to the processing chain.\r\n    /// </summary>    \r\n    /// <param name=\"key\" type=\"string\">property name that is parsed</param>\r\n    /// <param name=\"value\" type=\"any\">property value</param>\r\n    /// <returns type=\"date\">returns date or the original value if not a date string</returns>\r\n    if (typeof value === 'string') {\r\n        var a = reISO.exec(value);\r\n        if (a)\r\n            return new Date(value);\r\n        if (!parseMsAjaxDate)\r\n            return value;\r\n        a = reMsAjax.exec(value);\r\n        if (a) {\r\n            var b = a[1].split(/[-+,.]/);\r\n            return new Date(b[0] ? +b[0] : 0 - +b[1]);\r\n        }\r\n    }\r\n    return value;\r\n};\r\nexports.json = {\r\n    parse: function (str) {\r\n        try {\r\n            var res = JSON.parse(str, dateParser);\r\n            return res;\r\n        }\r\n        catch (e) {\r\n            // orignal error thrown has no error message so rethrow with message\r\n            throw new Error(\"JSON content could not be parsed\");\r\n        }\r\n    },\r\n    stringify: function (data) {\r\n        return JSON.stringify(data);\r\n    }\r\n};\r\n\n\n/***/ }),\n\n/***/ 1:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar json_1 = __webpack_require__(0);\r\nvar noop = function () { };\r\nvar ServerConnection = (function () {\r\n    function ServerConnection() {\r\n        this.connectionProtocol = 'ws'; //or wss\r\n        this.connectionRoute = 'ws';\r\n        this.reconnectTimeout = 5000;\r\n        this.reconnectIntervalRef = 0;\r\n        this.sendMessagesTimeout = 100;\r\n        this.sendMessagesIntervalRef = 0;\r\n        this.messagesQueue = [];\r\n        this.rawMessageHandlers = [];\r\n        this.notifyMessageHandlers = {};\r\n    }\r\n    ServerConnection.prototype.open = function () {\r\n        var _this = this;\r\n        this.connect();\r\n        clearInterval(this.reconnectIntervalRef);\r\n        this.reconnectIntervalRef = setInterval(function () {\r\n            if (!_this.ws || _this.ws.readyState !== WebSocket.OPEN) {\r\n                _this.connect();\r\n            }\r\n        }, this.reconnectTimeout);\r\n    };\r\n    ServerConnection.prototype.close = function () {\r\n        if (this.ws) {\r\n            this.ws.close();\r\n        }\r\n        clearInterval(this.reconnectIntervalRef);\r\n    };\r\n    Object.defineProperty(ServerConnection.prototype, \"isOpen\", {\r\n        get: function () {\r\n            return this.ws.readyState === WebSocket.OPEN;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerConnection.prototype.connect = function () {\r\n        var _this = this;\r\n        this.ws = new WebSocket(this.connectionProtocol + \"://\" + document.location.host + \"/\" + this.connectionRoute);\r\n        this.bindEvents();\r\n        clearInterval(this.sendMessagesIntervalRef);\r\n        this.sendMessagesIntervalRef = setInterval(function () {\r\n            _this.sendMessagesFromQueue();\r\n        }, this.sendMessagesTimeout);\r\n    };\r\n    ServerConnection.prototype.bindEvents = function () {\r\n        var _this = this;\r\n        this.ws.onclose = function () {\r\n            clearInterval(_this.sendMessagesIntervalRef);\r\n        };\r\n        this.ws.onmessage = function (ev) {\r\n            _this.rawMessage(ev);\r\n            _this.processNotifyMessage(ev);\r\n        };\r\n    };\r\n    ServerConnection.prototype.sendMessagesFromQueue = function () {\r\n        while (this.messagesQueue.length > 0) {\r\n            if (this.ws.readyState !== WebSocket.OPEN) {\r\n                break;\r\n            }\r\n            var data = this.messagesQueue.shift();\r\n            this.ws.send(data);\r\n        }\r\n    };\r\n    ServerConnection.prototype.send = function (data) {\r\n        this.messagesQueue.push(data);\r\n    };\r\n    ServerConnection.prototype.rawMessage = function (e) {\r\n        this.rawMessageHandlers.forEach(function (handler) { return handler(e); });\r\n    };\r\n    ServerConnection.prototype.onRawMessage = function (handler) {\r\n        var _this = this;\r\n        if (!handler) {\r\n            return noop;\r\n        }\r\n        this.rawMessageHandlers.push(handler);\r\n        return function () {\r\n            var index = _this.rawMessageHandlers.indexOf(handler);\r\n            if (index > -1) {\r\n                _this.rawMessageHandlers.splice(index, 1);\r\n            }\r\n        };\r\n    };\r\n    ServerConnection.prototype.processNotifyMessage = function (e) {\r\n        try {\r\n            var message_1 = json_1.json.parse(e.data);\r\n            if (message_1.messageRole === 'NotifyMessage'\r\n                && message_1.name\r\n                && this.notifyMessageHandlers[message_1.name]) {\r\n                this.notifyMessageHandlers[message_1.name]\r\n                    .forEach(function (handler) { return handler(message_1.data, message_1.attributes); });\r\n            }\r\n        }\r\n        catch (e) {\r\n        }\r\n    };\r\n    ServerConnection.prototype.onNotifyMessage = function (name, handler) {\r\n        var _this = this;\r\n        if (!(name && handler)) {\r\n            return noop;\r\n        }\r\n        if (!this.notifyMessageHandlers[name]) {\r\n            this.notifyMessageHandlers[name] = [];\r\n        }\r\n        this.notifyMessageHandlers[name].push(handler);\r\n        return function () {\r\n            var index = _this.notifyMessageHandlers[name].indexOf(handler);\r\n            if (index > -1) {\r\n                _this.notifyMessageHandlers[name].splice(index, 1);\r\n            }\r\n        };\r\n    };\r\n    return ServerConnection;\r\n}());\r\nexports.ServerConnection = ServerConnection;\r\nexports.connection = new ServerConnection();\r\n\n\n/***/ }),\n\n/***/ 16:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar serverConnection_1 = __webpack_require__(1);\r\ndebugger;\r\nserverConnection_1.connection.open();\r\nserverConnection_1.connection.send('Hello');\r\n\n\n/***/ })\n\n/******/ });\n\n\n// WEBPACK FOOTER //\n// public/javascript/app.bundle.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 16);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f4a2fd9c67eba7027774","\r\n//date parse method from https://weblog.west-wind.com/posts/2014/jan/06/javascript-json-date-parsing-and-real-dates\r\nconst reISO = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*))(?:Z|(\\+|-)([\\d|:]*))?$/;\r\nconst reMsAjax = /^\\/Date\\((d|-|.*)\\)[\\/|\\\\]$/;\r\n\r\nconst parseMsAjaxDate = false;\r\n\r\nconst dateParser = function (key, value) {\r\n    /// <summary>\r\n    /// Globally enables JSON date parsing for JSON.parse().\r\n    /// Replaces the default JSON.parse() method and adds\r\n    /// the datePaser() extension to the processing chain.\r\n    /// </summary>    \r\n    /// <param name=\"key\" type=\"string\">property name that is parsed</param>\r\n    /// <param name=\"value\" type=\"any\">property value</param>\r\n    /// <returns type=\"date\">returns date or the original value if not a date string</returns>\r\n    if (typeof value === 'string') {\r\n        var a = reISO.exec(value);\r\n        if (a)\r\n            return new Date(value);\r\n\r\n        if (!parseMsAjaxDate)\r\n            return value;\r\n\r\n        a = reMsAjax.exec(value);\r\n        if (a) {\r\n            var b = a[1].split(/[-+,.]/);\r\n            return new Date(b[0] ? +b[0] : 0 - +b[1]);\r\n        }\r\n    }\r\n    return value;\r\n};\r\n\r\n\r\nexport const json = { \r\n\r\n    parse(str: string): any {\r\n        try {\r\n            let res = JSON.parse(str, dateParser);\r\n            return res;\r\n        } catch (e) {\r\n            // orignal error thrown has no error message so rethrow with message\r\n            throw new Error(\"JSON content could not be parsed\");\r\n        }\r\n    },\r\n\r\n    stringify(data: any): string {\r\n        return JSON.stringify(data);\r\n    }\r\n};\n\n\n// WEBPACK FOOTER //\n// ./../Blades.WebClient/BladesWeb/tools/json.ts","import { json } from '../tools/json';\r\n\r\n\r\nconst noop = () => { };\r\n\r\nexport class ServerConnection {\r\n\r\n    public connectionProtocol: string = 'ws'; //or wss\r\n\r\n    public connectionRoute: string = 'ws';\r\n\r\n    private ws: WebSocket;\r\n\r\n\r\n    private reconnectTimeout: number = 5000;\r\n    private reconnectIntervalRef: number = 0; \r\n\r\n    private sendMessagesTimeout: number =  100;\r\n    private sendMessagesIntervalRef: number = 0; \r\n\r\n    public open(): void {\r\n        this.connect();\r\n\r\n        clearInterval(this.reconnectIntervalRef);\r\n        this.reconnectIntervalRef = setInterval(() => {\r\n            if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\r\n                this.connect();\r\n            }\r\n        }, this.reconnectTimeout);\r\n    }\r\n\r\n\r\n    public close(): void {\r\n        if (this.ws) {\r\n            this.ws.close();\r\n        }\r\n\r\n        clearInterval(this.reconnectIntervalRef);\r\n    }\r\n\r\n    public get isOpen() {\r\n        return this.ws.readyState === WebSocket.OPEN;\r\n    }\r\n\r\n    private connect() {\r\n        this.ws = new WebSocket(`${this.connectionProtocol}://${document.location.host}/${this.connectionRoute}`);\r\n        this.bindEvents();\r\n\r\n        clearInterval(this.sendMessagesIntervalRef);\r\n        this.sendMessagesIntervalRef = setInterval(() => {\r\n            this.sendMessagesFromQueue();\r\n        }, this.sendMessagesTimeout);\r\n    }\r\n\r\n    private bindEvents(): void {\r\n        this.ws.onclose = () => {\r\n            clearInterval(this.sendMessagesIntervalRef);\r\n        };\r\n\r\n        this.ws.onmessage = (ev) => {\r\n            this.rawMessage(ev);\r\n            this.processNotifyMessage(ev);\r\n        };\r\n    }\r\n\r\n\r\n    private messagesQueue: Array<any> = [];\r\n    private sendMessagesFromQueue(): void {\r\n        while (this.messagesQueue.length > 0) {\r\n            if (this.ws.readyState !== WebSocket.OPEN) {\r\n                break;\r\n            }\r\n\r\n            let data = this.messagesQueue.shift();\r\n            this.ws.send(data);\r\n        }\r\n    }\r\n\r\n    public send(data: any): void {\r\n        this.messagesQueue.push(data);\r\n    }\r\n\r\n\r\n\r\n    private rawMessageHandlers: Array<(e: MessageEvent) => void> = [];\r\n    private rawMessage(e: MessageEvent): void {\r\n        this.rawMessageHandlers.forEach(handler => handler(e));\r\n    }\r\n    public onRawMessage(handler: (e: MessageEvent) => void): () => void {\r\n        if (!handler) {\r\n            return noop;\r\n        }        \r\n\r\n        this.rawMessageHandlers.push(handler);\r\n        return () => {\r\n            let index = this.rawMessageHandlers.indexOf(handler);\r\n            if (index > -1) {\r\n                this.rawMessageHandlers.splice(index, 1);\r\n            }\r\n        };\r\n    }\r\n\r\n\r\n    private notifyMessageHandlers: {\r\n        [name: string]: Array<(data: any, attrs: any) => void>\r\n    } = {};\r\n\r\n    private processNotifyMessage(e: MessageEvent): void {\r\n        try {\r\n            let message = json.parse(e.data);\r\n            if (message.messageRole === 'NotifyMessage'\r\n                && message.name\r\n                && this.notifyMessageHandlers[message.name]) {\r\n\r\n                this.notifyMessageHandlers[message.name]\r\n                    .forEach(handler => handler(message.data, message.attributes));\r\n            }\r\n        } catch (e) {\r\n            //ignore\r\n        }\r\n    }\r\n\r\n    public onNotifyMessage(name: string, handler: (data: any, attrs: any) => void): () => void {\r\n        if (!(name && handler)) {\r\n            return noop;\r\n        } \r\n\r\n        if (!this.notifyMessageHandlers[name]) {\r\n            this.notifyMessageHandlers[name] = [];\r\n        }\r\n\r\n        this.notifyMessageHandlers[name].push(handler);\r\n\r\n        return () => {\r\n            let index = this.notifyMessageHandlers[name].indexOf(handler);\r\n            if (index > -1) {\r\n                this.notifyMessageHandlers[name].splice(index, 1);\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\n\r\n\r\nexport const connection = new ServerConnection();\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./../Blades.WebClient/BladesWeb/webApi/serverConnection.ts","import { connection } from 'blades-web/webApi/serverConnection';\r\n\r\ndebugger;\r\nconnection.open();\r\nconnection.send('Hello');\n\n\n// WEBPACK FOOTER //\n// ./frontend/main.ts"],"sourceRoot":""}